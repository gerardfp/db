# a1. Proyecci√≥n, filtrado, ordenaci√≥n, agregaci√≥n   

Crea una base de datos con la siguiente tabla:

```sql
create table empleados(
    id_empleado     serial,
    nombre          text,
    apellido        text,
    departamento    text,
    puesto          text,
    salario         numeric,
    fecha_contrato  date,
    ciudad          text,
    edad            integer
);
```

Inserta diversos emplados:

```sql
INSERT INTO empleados (nombre, apellido, departamento, puesto, salario, fecha_contrato, ciudad, edad) VALUES
('Ana',     'Garc√≠a',   'Ventas',     'Vendedor',       1800, '2018-03-15', 'Madrid',     29),
('Luis',    'P√©rez',    'Ventas',     'Jefe Ventas',    2500, '2015-07-01', 'Valencia',   41),
('Marta',   'L√≥pez',    'Marketing',  'Analista',       2200, '2020-01-20', 'Sevilla',    33),
('Carlos',  'Ruiz',     'IT',         'Programador',    2000, '2019-11-11', 'Madrid',     26),
('Sof√≠a',   'Torres',   'IT',         'Administrador',  2100, '2016-09-05', 'Barcelona',  39),
('Diego',   'Fern√°ndez','RRHH',       'T√©cnico',        1700, '2021-04-10', 'Valencia',   28),
('Luc√≠a',   'Mart√≠n',   'IT',         'Programador',    1950, '2017-02-14', 'Sevilla',    31),
('Pablo',   'Santos',   'Ventas',     'Vendedor',       1850, '2022-08-01', 'Madrid',     24),
('Elena',   'D√≠az',     'Marketing',  'Dise√±ador',      1900, '2019-05-23', 'Valencia',   30),
('Javier',  'Moreno',   'Ventas',     'Vendedor',       1750, '2018-10-10', 'Barcelona',  27),
('Raquel',  'Ram√≠rez',  'IT',         'Programador',    2050, '2021-12-01', 'Madrid',     25),
('Tom√°s',   'Vidal',    'IT',         'Administrador',  2150, '2014-06-18', 'Sevilla',    44),
('Clara',   'Navas',    'RRHH',       'Jefe RRHH',      2400, '2013-09-09', 'Madrid',     45),
('Sergio',  'G√≥mez',    'Marketing',  'Analista',       2250, '2022-03-15', 'Barcelona',  29),
('Laura',   'Su√°rez',   'Ventas',     'Vendedor',       1900, '2016-07-25', 'Valencia',   37),
('Andr√©s',  'Ortega',   'IT',         'Programador',    2100, '2020-08-30', 'Madrid',     32),
('Patricia','Castro',   'Marketing',  'Dise√±ador',      1850, '2017-04-12', 'Sevilla',    34),
('Fernando','Blanco',   'IT',         'Jefe IT',        2800, '2012-11-05', 'Barcelona',  50),
('Isabel',  'Serrano',  'RRHH',       'T√©cnico',        1750, '2019-01-16', 'Madrid',     27),
('David',   'Iglesias', 'Ventas',     'Vendedor',       1800, '2021-09-21', 'Sevilla',    23);
```

üîé Realiza las siguientes consultas:

1. Todos los datos de todos los empleados
1. Los nombres y apellidos de todos los empleados
1. El nombre, departamento y salario de cada empleado
1. Los departamentos, eliminando duplicados
1. Las ciudades, ordenadas 
1. Los departamentos que tiene cada ciudad
1. Los empleados del departamento `IT`
1. Los empleados que trabajan en `Valencia`
1. Los empleados con un salario mayor a `2000`
1. Los empleados con edad entre `25` y `35`
1. Los empleados contratados despu√©s del `1 de enero de 2020`
1. Los empleados cuyo apellido empiece por la letra `G`
1. Los empleados que tengan el puesto de `Programador` o `Administrador`
1. Las ciudades que tengan alg√∫n `Jefe`
1. Los empleados de `Madrid` y `Barcelona` contratados despu√©s del `1 de enero de 2020`
1. Los empleados que **no** pertenecen al departamento `Ventas`
1. Nombre y apellidos de los empleados con el apellido posterior a `Garc√≠a`
1. Los `5` empleados con el salario m√°s alto
1. Los siguientes `5` empleados con el salario m√°s alto
1. Los `5` empleados con el salario m√°s bajo
1. Los `3` empleados m√°s jovenes que trabajen en `IT` o `Marketing`
1. Los `5` empleados contratados entre `2015` y `2020`, que hayan sido contratados m√°s recientemente
1. Los empleados cuyo salario est√© entre `1800` y `2200`, y que trabajen en `Madrid` o `Barcelona`
1. Los empleados cuyo apellido termine en `ez` y ordena por salario descendente. Muestra solo el segundo resultado
1. Los `3` empleados con mayor edad que **no** trabajen en el departamento de `Ventas`
1. Los empleados con nombre de m√°s de `5` caracteres y ordena primero por departamento ascendente y luego por edad descendente
1. Los empleados que tengan un salario superior a `2000` y cuya edad no est√© entre `30` y `40` a√±os. Ord√©nalos de menor a mayor salario y muestra solo los dos primeros
1. Los empleados de `Sevilla` y `Valencia` cuyo puesto contenga la palabra `Vendedor` o `Programador`
1. Los empleados con edad impar (`edad % 2 = 1`), ord√©nalos de mayor a menor edad y muestra el empleado en la posici√≥n `4`
1. Los `5` empleados con salario m√°s bajo, excluyendo a los que trabajan en `Madrid`
1. Los empleados que trabajan en `IT` o `Ventas`, tienen un salario entre `1800` y `2200`, su edad est√° entre `25` y `40`, y trabajan en `Madrid`, `Barcelona` o `Valencia`
1. El salario medio de todos los empleados
1. El salario medio de los empleados de `Valencia`
1. La suma de salarios de los empleados de `IT`
1. El salario m√°s alto
1. El salario m√°s bajo de `Valencia`
1. El empleado con el salario m√°s alto
1. El empleado con el salario m√°s bajo de `Valencia`
1. N√∫mero de empleados por departamento
1. N√∫mero de empleados por ciudad
1. Salario medio por departamento
1. Salario m√°ximo por ciudad
1. Edad media de los empleados por departamento
1. N√∫mero de empleados por puesto, ordenados de mayor a menor
1. Salario medio por ciudad, mostrando solo aquellas ciudades con salario medio superior a `2000`
1. N√∫mero de empleados por departamento, mostrando solo los que tengan m√°s de `3` empleados
1. Salario medio por departamento, ordenado descendentemente y mostrando solo el salario medio
1. La suma de salarios por ciudad y departamento
1. N√∫mero de empleados por departamento y ciudad, mostrando solo los casos donde haya m√°s de `1` empleado en esa combinaci√≥n
1. Salario m√°ximo y m√≠nimo por departamento
1. Edad media por departamento, mostrando solo aquellos departamentos donde la edad media sea mayor a `35`
1. Los departamentos que tengan al menos un empleado contratado despu√©s de `2020-01-01` y con salario superior a `2000`
1. Salario medio por puesto, mostrando solo los puestos cuyo salario medio sea mayor que el salario medio global de todos los empleados
1. Los empleados cuyo salario sea mayor que el salario medio de todos los empleados
1. Los empleados que trabajan en el mismo departamento que `Ana Garc√≠a`
1. Los empleados que tienen el mismo puesto que el empleado con id_empleado igual a `5`
1. Los empleados cuyo salario sea igual al salario m√°ximo del departamento de `IT`
1. Los empleados que trabajan en la misma ciudad que `Luis P√©rez` o `Pablo Santos`
1. Nombre y salario de los empleados que ganan m√°s que la media de su propio departamento
1. Empleados cuyo salario sea mayor que el salario medio de la ciudad en la que trabajan
1. Empleados que tengan un salario superior al del empleado m√°s joven de la empresa
1. Empleados cuya fecha de contrato sea posterior a la fecha de contrato del empleado con mayor salario
1. Empleados que trabajan en departamentos que tengan al menos un `Jefe`
1. Empleados que ganan m√°s que el segundo salario m√°s alto de la empresa
1. Empleados que trabajan en la ciudad con m√°s empleados
1. Empleados cuyo salario sea superior al salario m√°ximo de al menos un departamento distinto al suyo
1. Empleados que trabajan en departamentos cuyo salario medio es mayor que el salario medio global de la empresa
1. Nombre y apellido de los empleados que tienen el mismo salario que otro empleado de un departamento distinto

<br />

## üìñ Referencia

### 1. üîπ Sintaxis general de una consulta

```sql
SELECT [DISTINCT] campos
FROM tabla
[WHERE condiciones]
[GROUP BY campos]
[HAVING condiciones]
[ORDER BY campos [ASC|DESC]]
[LIMIT cantidad]
[OFFSET inicio];
```

### 2. üîπ Selecci√≥n de datos (SELECT)

`SELECT *` ‚Üí devuelve todas las columnas.

`SELECT columna1, columna2` ‚Üí devuelve solo esas columnas.

`SELECT DISTINCT columna` ‚Üí elimina duplicados.

üëÄ Ejemplo:

```sql
SELECT nombre, apellido FROM empleados;
SELECT DISTINCT departamento FROM empleados;
```

### 3. üîπ Filtrado de filas (WHERE)

Sirve para establecer condiciones:

Comparaciones:

```sql
=   !=   >   <   >=    <=
```

Rango:
```sql 
BETWEEN valor1 AND valor2
```

Conjunto:

```sql
IN (valores)
```

Patrones:

```sql
LIKE 'A%' (empieza por A)
LIKE '%z' (termina en z)
LIKE '%rr%' (contiene ‚Äúrr‚Äù)
```

üëÄ Ejemplo:

```sql
SELECT * FROM empleados WHERE salario > 2000;
SELECT * FROM empleados WHERE apellido LIKE 'G%';
```

### 4. üîπ Ordenaci√≥n (ORDER BY)

Ordena los resultados por una o m√°s columnas.

`ASC` ‚Üí ascendente (por defecto).

`DESC` ‚Üí descendente.

üëÄ Ejemplo:

```sql
SELECT nombre, salario
FROM empleados
ORDER BY salario DESC;
```

### 5. üîπ Limitaci√≥n de resultados (LIMIT y OFFSET)

`LIMIT n` ‚Üí muestra solo los primeros `n` resultados.

`OFFSET m` ‚Üí salta los `m` primeros resultados.

üëÄ Ejemplo:

```sql
-- Los 5 salarios m√°s altos
SELECT nombre, salario
FROM empleados
ORDER BY salario DESC
LIMIT 5;

-- Los siguientes 5 salarios m√°s altos
SELECT nombre, salario
FROM empleados
ORDER BY salario DESC
LIMIT 5 OFFSET 5;
```

### 6. üîπ Operadores l√≥gicos

`AND` ‚Üí ambas condiciones deben cumplirse.

`OR` ‚Üí al menos una condici√≥n se cumple.

`NOT` ‚Üí niega la condici√≥n.

üëÄ Ejemplo:

```sql
SELECT * 
FROM empleados
WHERE ciudad IN ('Madrid', 'Barcelona')
  AND fecha_contrato > '2020-01-01';
```

### 7. üîπ Funciones de agregaci√≥n (reducci√≥n)

Se aplican sobre grupos de filas y devuelven un √∫nico valor:

`COUNT(*)` ‚Üí cuenta filas.

`SUM(columna)` ‚Üí suma valores.

`AVG(columna)` ‚Üí media.

`MIN(columna)` ‚Üí m√≠nimo.

`MAX(columna)` ‚Üí m√°ximo.

üëÄ Ejemplo:

```sql
SELECT departamento, AVG(salario) AS salario_medio
FROM empleados
GROUP BY departamento;
```

### 8. üîπ Agrupaci√≥n (GROUP BY)

Agrupa filas seg√∫n los valores de una o varias columnas.

<img src="./docs/groupby.png" />

üëÄ Ejemplo:

```sql
SELECT ciudad, COUNT(*) AS empleados_por_ciudad
FROM empleados
GROUP BY ciudad;
```

### 9. üîπ Filtro sobre grupos (HAVING)

Sirve para filtrar resultados despu√©s de agrupar (a diferencia de WHERE, que filtra filas antes del GROUP BY).

üëÄ Ejemplo:

```sql
-- Ciudades con salario medio superior a 2000
SELECT ciudad, AVG(salario) AS salario_medio
FROM empleados
GROUP BY ciudad
HAVING AVG(salario) > 2000;
```

### 10. üîπ Subconsultas

Una consulta dentro de otra.

üëÄ Ejemplo:

```sql
-- Puestos con salario medio superior al global
SELECT puesto, AVG(salario)
FROM empleados
GROUP BY puesto
HAVING AVG(salario) > (SELECT AVG(salario) FROM empleados);
```

### 11. üîπ Funciones de cadenas y c√°lculo

`LENGTH(cadena)` ‚Üí longitud de un texto.

`||` ‚Üí concatenaci√≥n de cadenas.

`edad % 2 = 1` ‚Üí comprobar si un n√∫mero es impar.

üëÄ Ejemplo:

```sql
-- Empleados con nombre largo
SELECT nombre, LENGTH(nombre) AS longitud
FROM empleados
WHERE LENGTH(nombre) > 5;
```



